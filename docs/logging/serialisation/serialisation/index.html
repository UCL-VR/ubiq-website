<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://ucl-vr.github.io/ubiq-website/fonts/vendor/nunito-sans/nunito-sans-v11-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://ucl-vr.github.io/ubiq-website/fonts/vendor/nunito/nunito-v22-latin-700.woff2 type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script integrity="sha512-RBYr6Ld4w1yVqaACrgrBLQfPgGhj/1jyacA74WxJ1KM6KVcSWymwrdDwb3HDcdpwiNJ5yssot1He0U9vXoQVlg==">(()=>{var b=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("theme");b&&a===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),b&&a==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),a==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=/ubiq-website/main.bbf28444a5ce075f9dbaa2e2acf190a6334c8847394c373c3f66f819f878a8e023edb109b9b18771f4a5c9a718fb4fd0a2b655595d5acb8cb89c7347538bdfe4.css integrity="sha512-u/KERKXOB1+duqLirPGQpjNMiEc5TDc8P2b4Gfh4qOAj7bEJubGHcfSlyacY+0/QorZVWV1ay4y4nHNHU4vf5A==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Serialisation and Memory Ubiq</title><meta name=description content="A Unity networking library for research, teaching and development, maintained by the Virtual Environments and Computer Graphics group at UCL. Ubiq is 100% free and open source."><link rel=canonical href=https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Serialisation and Memory"><meta property="og:description" content="Serialiser The logging functionality uses a custom Json serialiser that facilitates building Json objects across multiple function calls.
This is based on neuecc&rsquo;s Utf8Json, but with modifications to track memory usage and remove code generation requirements.
The Utf8Json serialiser is in the Ubiq.Logging.Utf8Json namspace. It is not recommended to use the serialiser for purposes other than logging; import an unmodified version of the library separately instead.
Formatters Libraries such as Utf8Json typically have methods that serialise and deseralise specific types by sequentially reading and writing tokens to and from streams."><meta property="og:url" content="https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/"><meta property="og:site_name" content="Ubiq"><meta property="article:published_time" content="2020-09-21T13:58:42+02:00"><meta property="article:modified_time" content="2026-02-04T19:10:40+00:00"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="640"><meta property="og:image:alt" content="Serialisation and Memory"><meta property="og:image" content="https://ucl-vr.github.io/ubiq-website/images/banner.png"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="640"><meta property="og:image:alt" content="Ubiq"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Serialisation and Memory"><meta name=twitter:description content><meta name=twitter:image content><meta name=twitter:image:alt content="Serialisation and Memory"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://ucl-vr.github.io/#/schema/organization/1","name":"Ubiq","url":"https://ucl-vr.github.io/","sameAs":["https://github.com/UCL-VR/ubiq"],"logo":{"@type":"ImageObject","@id":"https://ucl-vr.github.io/#/schema/image/1","url":"https://ucl-vr.github.io/images/logos/ubiq-logo.png","width":512,"height":512,"caption":"Ubiq"},"image":{"@id":"https://ucl-vr.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://ucl-vr.github.io/#/schema/website/1","url":"https://ucl-vr.github.io/","name":"Ubiq","description":"A Unity networking library for research, teaching and development, maintained by the Virtual Environments and Computer Graphics group at UCL. Ubiq is 100% free and open source.","publisher":{"@id":"https://ucl-vr.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/","url":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/","name":"Serialisation and Memory","description":"","isPartOf":{"@id":"https://ucl-vr.github.io/#/schema/website/1"},"about":{"@id":"https://ucl-vr.github.io/#/schema/organization/1"},"datePublished":"2020-09-21T13:58:42CET","dateModified":"2026-02-04T19:10:40CET","breadcrumb":{"@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/"]}]},{"@type":"BreadcrumbList","@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://ucl-vr.github.io/ubiq-website/","url":"https://ucl-vr.github.io/ubiq-website/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://ucl-vr.github.io/ubiq-website/docs/","url":"https://ucl-vr.github.io/ubiq-website/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/","url":"https://ucl-vr.github.io/ubiq-website/docs/logging/","name":"Logging"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/","url":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/","name":"Serialisation"}},{"@type":"ListItem","position":5,"item":{"@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://ucl-vr.github.io/#/schema/article/1","headline":"Serialisation and Memory","description":"","isPartOf":{"@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/"},"mainEntityOfPage":{"@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/"},"datePublished":"2020-09-21T13:58:42CET","dateModified":"2026-02-04T19:10:40CET","author":{"@id":"https://ucl-vr.github.io/#/schema/person/2"},"publisher":{"@id":"https://ucl-vr.github.io/#/schema/organization/1"},"image":{"@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://ucl-vr.github.io/#/schema/person/2","name":"Nels Numan","sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/#/schema/image/2","url":null,"contentUrl":null,"width":1826,"height":874,"caption":"Serialisation and Memory"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://ucl-vr.github.io/ubiq-website/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ucl-vr.github.io/ubiq-website/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ucl-vr.github.io/ubiq-website/favicon-16x16.png><link rel=manifest href=https://ucl-vr.github.io/ubiq-website/site.webmanifest></head><body class="single section docs"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ubiq-website/ aria-label=Bootstrap>Ubiq</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-start border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/ubiq-website/>Ubiq</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1 active" href=https://ucl-vr.github.io/ubiq/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/ubiq-website/showcase/>Showcase</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/ubiq-website/blog/>Blog</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/ubiq-website/publication/>Publications</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/ubiq-website/teaching>Teaching</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Contact
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=https://github.com/UCL-VR/ubiq/discussions/categories/q-a>â†— Ask a Question</a></li><li><a class=dropdown-item href=/ubiq-website/contributors/>Contributors</a></li><li><a class=dropdown-item href=/ubiq-website/media/>Media</a></li></ul></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://discord.gg/cZYzdcxAAB><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 128 128" fill="#000" stroke="currentcolor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-discord"><path d="M45.23 57.2c-6.16.0-11.17 5.6-11.17 12.48s5 12.47 11.17 12.47 11.16-5.59 11.16-12.47S51.38 57.2 45.23 57.2zm0 21c-4 0-7.17-3.8-7.17-8.47s3.21-8.48 7.17-8.48 7.16 3.8 7.16 8.48-3.21 8.42-7.16 8.42z"/><path d="M121.83 59.58a156.78 156.78.0 00-11.52-31 2.1 2.1.0 00-.71-.77 87.08 87.08.0 00-15.23-7.17C84.55 17.07 79.91 17 79.72 17a2 2 0 00-2 1.72l-.6 4.17a133.14 133.14.0 00-26.28.0l-.6-4.17a2 2 0 00-2-1.72c-.19.0-4.83.0-14.65 3.61A87.08 87.08.0 0018.4 27.81a2.1 2.1.0 00-.71.77 156.72 156.72.0 00-11.52 31C1 80.46.0 90.91.0 91.34a2 2 0 00.49 1.5 55.2 55.2.0 0018.2 12.74A76.32 76.32.0 0038.48 111a2 2 0 001.92-1l5.4-9.25A105.08 105.08.0 0064 102.24a105.08 105.08.0 0018.2-1.51L87.6 110a2 2 0 001.72 1h.2a76.32 76.32.0 0019.78-5.38 55.2 55.2.0 0018.2-12.74 2 2 0 00.49-1.5C128 90.91 127.05 80.46 121.83 59.58zm-14.06 42.31a76.76 76.76.0 01-17.39 4.92l-4.08-7c4.68-1.24 14.42-4.46 21.83-11.2a2 2 0 10-2.69-3c-9 8.23-22.46 10.84-22.6 10.87h-.06A96.59 96.59.0 0164 98.24a96.59 96.59.0 01-18.78-1.7h-.06c-.14.0-13.55-2.64-22.6-10.87a2 2 0 10-2.69 3c7.41 6.74 17.15 10 21.83 11.2l-4.08 7a76.08 76.08.0 01-17.39-4.92A52.24 52.24.0 014.08 90.8c.33-2.91 1.68-13.07 6-30.24A156.25 156.25.0 0121 30.92 88.17 88.17.0 0135 24.4a61.35 61.35.0 0111.58-3.19l.35 2.39c-4 1-13.85 3.86-21.65 9.53a2 2 0 102.36 3.23c8.82-6.41 21-9.06 21.86-9.25A118.4 118.4.0 0164 26.27a117.64 117.64.0 0114.51.84c.91.19 13 2.83 21.86 9.25a2 2 0 102.36-3.23c-7.8-5.67-17.61-8.52-21.65-9.53l.35-2.39A61.75 61.75.0 0193 24.4a88.17 88.17.0 0114 6.52 156.25 156.25.0 0111 29.64c4.29 17.17 5.64 27.33 6 30.24a52.24 52.24.0 01-16.23 11.09z"/><path d="M82.77 57.2c-6.15.0-11.16 5.6-11.16 12.48s5 12.47 11.16 12.47 11.17-5.59 11.17-12.47S88.93 57.2 82.77 57.2zm0 21c-4 0-7.16-3.8-7.16-8.47s3.21-8.48 7.16-8.48 7.17 3.8 7.17 8.48S86.73 78.15 82.77 78.15z"/></svg><small class="ms-2 d-md-none">Discord</small></a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/UCL-VR/ubiq/><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-xxl d-flex align-items-md-center"><div class="d-inline-flex me-auto placeholder-glow"><div id=search-placeholder aria-hidden=true><a href=# tabindex=-1 class="btn btn-light disabled placeholder"></a></div><div id=docsearch></div></div><span class="navbar-text fs-6 d-none d-sm-block">v0.2.0-alpha.4.</span>
<button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bf647454e36069fd16f1a7a35cf6a865 aria-expanded=false>
Getting Started</button><div class=collapse id=section-bf647454e36069fd16f1a7a35cf6a865><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/getting-ubiq/>Getting Ubiq</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/setting-up-vr/>Setting Up Ubiq for XR</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/creating-networked-objects/>Creating Networked Objects</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/object-spawning/>Object Spawning</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/ownership/>Ownership</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/interaction-ubiq-xr/>Interaction with Ubiq XR</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/servers-rooms/>Servers and Rooms</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/local-loopback/>Testing with Local Loopback</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/logging/>Logging</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9aa1b03934893d7134a660af4204f2a9 aria-expanded=false>
Server</button><div class=collapse id=section-9aa1b03934893d7134a660af4204f2a9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/server/server-setup/>Setting up the Server</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-61ee5a22cd5f14ed4e48eb5611031e74 aria-expanded=false>
Interaction</button><div class=collapse id=section-61ee5a22cd5f14ed4e48eb5611031e74><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/interaction/>XR Interaction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/3dinteraction/>3D Interaction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/2dinteraction/>2D Interaction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/playercontroller/>Player Controller</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8db7df66ab1d7ab5f1dc947acdb5fae4 aria-expanded=true>
Logging</button><div class="collapse show" id=section-8db7df66ab1d7ab5f1dc947acdb5fae4><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/logging/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/logging/analysis/>Analysis</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/logging/examples/>Examples</a></li><li><a class="docs-link rounded active" href=https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/>Serialisation and Memory</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-b54fa74b22da5a748eae3d55ad264199 aria-expanded=false>
Messaging</button><div class=collapse id=section-b54fa74b22da5a748eae3d55ad264199><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/ids/>Object and Component Ids</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/generating-ids/>Generating Unique Ids</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/types/>Types</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/reserveids/>Reserved IDs</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d8621144cbc61520339c3b10c61731f0 aria-expanded=false>
WebRTC</button><div class=collapse id=section-d8621144cbc61520339c3b10c61731f0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/webrtc/webrtc/>WebRTC and VOIP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1ebdf9048046e5822bbd758458891444 aria-expanded=false>
Servers and Rooms</button><div class=collapse id=section-1ebdf9048046e5822bbd758458891444><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/server-overview/>Server Overview</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/heartbeat/>Heartbeat and Timeouts</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/leaving-joining/>Leaving and Joining</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-857371ebf58168027de2852c70452e5a aria-expanded=false>
Async Design Patterns</button><div class=collapse id=section-857371ebf58168027de2852c70452e5a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/async-design-patterns/design-pattern/>Design Pattern</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-a669003ea35aa39ca280b83bd259a032 aria-expanded=false>
Packaging</button><div class=collapse id=section-a669003ea35aa39ca280b83bd259a032><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/packaging/packaging/>Packaging</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-b6755d218d5f4e1cef9cce9cc39aeda9 aria-expanded=false>
Meta</button><div class=collapse id=section-b6755d218d5f4e1cef9cce9cc39aeda9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/meta/docscommands/>MkDocs Commands</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bf647454e36069fd16f1a7a35cf6a865 aria-expanded=false>
Getting Started</button><div class=collapse id=section-bf647454e36069fd16f1a7a35cf6a865><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/getting-ubiq/>Getting Ubiq</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/setting-up-vr/>Setting Up Ubiq for XR</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/creating-networked-objects/>Creating Networked Objects</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/object-spawning/>Object Spawning</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/ownership/>Ownership</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/interaction-ubiq-xr/>Interaction with Ubiq XR</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/servers-rooms/>Servers and Rooms</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/local-loopback/>Testing with Local Loopback</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/getting-started/logging/>Logging</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-9aa1b03934893d7134a660af4204f2a9 aria-expanded=false>
Server</button><div class=collapse id=section-9aa1b03934893d7134a660af4204f2a9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/server/server-setup/>Setting up the Server</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-61ee5a22cd5f14ed4e48eb5611031e74 aria-expanded=false>
Interaction</button><div class=collapse id=section-61ee5a22cd5f14ed4e48eb5611031e74><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/interaction/>XR Interaction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/3dinteraction/>3D Interaction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/2dinteraction/>2D Interaction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/interaction/playercontroller/>Player Controller</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-8db7df66ab1d7ab5f1dc947acdb5fae4 aria-expanded=true>
Logging</button><div class="collapse show" id=section-8db7df66ab1d7ab5f1dc947acdb5fae4><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/logging/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/logging/analysis/>Analysis</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/logging/examples/>Examples</a></li><li><a class="docs-link rounded active" href=https://ucl-vr.github.io/ubiq-website/docs/logging/serialisation/serialisation/>Serialisation and Memory</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-b54fa74b22da5a748eae3d55ad264199 aria-expanded=false>
Messaging</button><div class=collapse id=section-b54fa74b22da5a748eae3d55ad264199><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/ids/>Object and Component Ids</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/generating-ids/>Generating Unique Ids</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/types/>Types</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/messaging/reserveids/>Reserved IDs</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d8621144cbc61520339c3b10c61731f0 aria-expanded=false>
WebRTC</button><div class=collapse id=section-d8621144cbc61520339c3b10c61731f0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/webrtc/webrtc/>WebRTC and VOIP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-1ebdf9048046e5822bbd758458891444 aria-expanded=false>
Servers and Rooms</button><div class=collapse id=section-1ebdf9048046e5822bbd758458891444><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/server-overview/>Server Overview</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/heartbeat/>Heartbeat and Timeouts</a></li><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/servers-and-rooms/leaving-joining/>Leaving and Joining</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-857371ebf58168027de2852c70452e5a aria-expanded=false>
Async Design Patterns</button><div class=collapse id=section-857371ebf58168027de2852c70452e5a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/async-design-patterns/design-pattern/>Design Pattern</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-a669003ea35aa39ca280b83bd259a032 aria-expanded=false>
Packaging</button><div class=collapse id=section-a669003ea35aa39ca280b83bd259a032><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/packaging/packaging/>Packaging</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-b6755d218d5f4e1cef9cce9cc39aeda9 aria-expanded=false>
Meta</button><div class=collapse id=section-b6755d218d5f4e1cef9cce9cc39aeda9><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://ucl-vr.github.io/ubiq-website/docs/meta/docscommands/>MkDocs Commands</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Quaternary navigation"><div class=page-links><h2 class=h3>On this page</h2><nav id=TableOfContents><ul><li><a href=#serialiser>Serialiser</a></li><li><a href=#formatters>Formatters</a><ul><li><a href=#code-generation>Code Generation</a></li><li><a href=#resolvers-and-formatters>Resolvers and Formatters</a></li><li><a href=#caching>Caching</a></li><li><a href=#memory-management>Memory Management</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Serialisation and Memory</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h2 class=h3>On this page</h2><nav id=TableOfContents><ul><li><a href=#serialiser>Serialiser</a></li><li><a href=#formatters>Formatters</a><ul><li><a href=#code-generation>Code Generation</a></li><li><a href=#resolvers-and-formatters>Resolvers and Formatters</a></li><li><a href=#caching>Caching</a></li><li><a href=#memory-management>Memory Management</a></li></ul></li></ul></nav></div></nav><h2 id=serialiser>Serialiser<a href=#serialiser class=anchor aria-hidden=true>#</a></h2><p>The logging functionality uses a custom Json serialiser that facilitates building Json objects across multiple function calls.</p><p>This is based on <a href=https://github.com/neuecc/Utf8Json>neuecc&rsquo;s Utf8Json</a>, but with modifications to track memory usage and remove code generation requirements.</p><p>The Utf8Json serialiser is in the <code>Ubiq.Logging.Utf8Json</code> namspace. It is not recommended to use the serialiser for purposes other than logging; import an unmodified version of the library separately instead.</p><h2 id=formatters>Formatters<a href=#formatters class=anchor aria-hidden=true>#</a></h2><p>Libraries such as Utf8Json typically have methods that serialise and deseralise specific types by sequentially reading and writing tokens to and from streams. (In this case, the tokes are read and written using the <code>JsonReader</code> and <code>JsonWriter</code> structures.)</p><p>Utf8Json finds the appropriate method to use using <code>FormatterResovler</code> classes. These classes return a cached <code>Formatter&lt;T></code> class, which is an object with two methods to read and write objects of type <code>T</code> as Json.</p><p>The included version of Utf8Json includes formatters for a number of known types, including all the basic primitives, and enums. Enums are serialised as names.</p><h3 id=code-generation>Code Generation<a href=#code-generation class=anchor aria-hidden=true>#</a></h3><p>To serialise types that do not have an explicit formatter defined, libraries such as Utf8Json usually build serialisation methods at runtime using code generation. This is not supported on platforms that use <a href=https://docs.unity3d.com/Manual/ScriptingRestrictions.html>IL2CPP</a> however.</p><p>To avoid code generation, unknown types are serialised by the Unity JsonUtility and embedded as objects.</p><h3 id=resolvers-and-formatters>Resolvers and Formatters<a href=#resolvers-and-formatters class=anchor aria-hidden=true>#</a></h3><p>When a type is serialised, Utf8Json will use the <code>DefaultResolver</code> to find a formatter. The <code>DefaultResolver</code> is defined in the <code>JsonSerializer</code> class as a static member and returns a <code>StandardResolver</code>, a type of composite resolver. This resolver will search each resolver registered to it in turn, and return the first <code>Formatter</code> that matches the type. The <code>StandardResolver</code> includes formatters for the built-in types, and the dynamic formatter fallback.</p><h3 id=caching>Caching<a href=#caching class=anchor aria-hidden=true>#</a></h3><p>Utf8Json makes common use of the following design pattern.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>public</span> <span class=nx>IJsonFormatter</span><span class=p>&lt;</span> <span class=nx>T</span> <span class=p>&gt;</span> <span class=nx>GetFormatter</span><span class=p>&lt;</span> <span class=nx>T</span> <span class=p>&gt;()</span>
<span class=p>{</span>
    <span class=k>return</span> <span class=nx>FormatterCache</span><span class=p>&lt;</span> <span class=nx>T</span> <span class=p>&gt;.</span><span class=nx>formatter</span><span class=p>;</span>
<span class=p>}</span>

<span class=nx>static</span> <span class=nx>class</span> <span class=nx>FormatterCache</span><span class=p>&lt;</span> <span class=nx>T</span> <span class=p>&gt;</span>
<span class=p>{</span>
    <span class=nx>public</span> <span class=nx>static</span> <span class=nx>readonly</span> <span class=nx>IJsonFormatter</span><span class=p>&lt;</span> <span class=nx>T</span> <span class=p>&gt;</span> <span class=nx>formatter</span><span class=p>;</span>

    <span class=nx>static</span> <span class=nf>FormatterCache</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nx>formatter</span> <span class=p>=</span> <span class=p>(</span><span class=nx>IJsonFormatter</span><span class=p>&lt;</span><span class=nx>T</span><span class=p>&gt;)</span><span class=nx>BuiltinResolverGetFormatterHelper</span><span class=p>.</span><span class=nf>GetFormatter</span><span class=p>(</span><span class=nf>typeof</span><span class=p>(</span><span class=nx>T</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></div><p>This snippet leverages the behaviour of generics in C# to replace formatter references in code, without using code generation. In C#, when a generic type is <a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/generics-in-the-run-time>first constructed</a>, the runtime will produce the concrete type and substitute it in the appropriate locations in the MSIL. The static constructor is <a href=https://ucl-vr.github.io/ubiq/eventlogserialisation/(https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors)>called</a> before the formatter is referenced for the first time.</p><p>That is, the generic <code>FormatterCache</code> type is replaced in the MSIL and the formatter member it returns is resolved on demand (when the <code>FormatterCache&lt;T></code> is first constructed).</p><h3 id=memory-management>Memory Management<a href=#memory-management class=anchor aria-hidden=true>#</a></h3><p>The Utf8Json namespace manages its own global memory pools to minimise GC allocations. It does not track memory usage directly however.</p><p>Instead, <code>LogManager</code> instances track how many bytes of pooled memory they have in their queues at any time, and use this to control whether new events are buffered or dropped.</p><p>Memory is rented from the pool on demand by <code>JsonWriter</code> objects created by <code>EventLogger</code> instances. Outstanding memory is returned to the pool when a <code>JsonWriter</code> is disposed. <code>JsonWriters</code> are disposed by the <code>LogManager</code> they are fed to, either after being copied for transmission or discarded when the buffer reaches capacity. <code>EventLogger</code> instances only create <code>JsonWriters</code> if a <code>LogManager</code> has been registered to recieve (and dispose of) the completed object.</p><p class=edit-page><a href=https://github.com/UCL-VR/ubiq-website/blob/master/content/docs/logging/serialisation/serialisation.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=/ubiq-website/docs/logging/examples/><div class="card my-1"><div class="card-body py-2">&larr; Examples</div></div></a><a class=ms-auto href=/ubiq-website/docs/async-design-patterns/design-pattern/><div class="card my-1"><div class="card-body py-2">Design Pattern &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/ubiq-website/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script data-goatcounter=https://ubiq.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script src=/ubiq-website/js/bootstrap.min.fdbe9b9ba88a036135318f3c721784d684ac9e3280fe282cc80d7d49f7f9c82780cd54228c1608685a230c09984300d7946fc471734d566fcebc148b65bd16db.js integrity="sha512-/b6bm6iKA2E1MY88cheE1oSsnjKA/igsyA19Sff5yCeAzVQijBYIaFojDAmYQwDXlG/EcXNNVm/OvBSLZb0W2w==" crossorigin=anonymous defer></script>
<script src=/ubiq-website/js/highlight.min.2a3ca603c4e5468838fb437bc036b9ddc036b6668b5dd45804f048229ea684f98f5928dd485b41db90e55aaa28b36600341f082d2726650a0a394250b6bf3ac1.js integrity="sha512-KjymA8TlRog4+0N7wDa53cA2tmaLXdRYBPBIIp6mhPmPWSjdSFtB25DlWqoos2YANB8ILScmZQoKOUJQtr86wQ==" crossorigin=anonymous defer></script>
<script src=/ubiq-website/js/docsearch.min.8ac9e466dd63e5171a8d4a02b9ad668ff651952b76713125523401bbb1b2c79e11638f70cad4f969eff292608e518b7685c05c5bc33c898e872a1c559767b20e.js integrity="sha512-isnkZt1j5RcajUoCua1mj/ZRlSt2cTElUjQBu7Gyx54RY49wytT5ae/ykmCOUYt2hcBcW8M8iY6HKhxVl2eyDg==" crossorigin=anonymous defer></script>
<script src=/ubiq-website/main.min.7692813ef22de5d343339990192d5774c0742a9334f8f57bb78245f5ab0e02861e3e47e7308e649ca0173ef9e307477de2769299fdb90a9e4a5e327df94553b7.js integrity="sha512-dpKBPvIt5dNDM5mQGS1XdMB0KpM0+PV7t4JF9asOAoYePkfnMI5knKAXPvnjB0d94naSmf25Cp5KXjJ9+UVTtw==" crossorigin=anonymous defer></script></body></html>