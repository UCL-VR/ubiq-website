<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://ubiq.online/fonts/vendor/nunito-sans/nunito-sans-v11-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://ubiq.online/fonts/vendor/nunito/nunito-v22-latin-700.woff2 type=font/woff2 crossorigin><script integrity="sha512-RBYr6Ld4w1yVqaACrgrBLQfPgGhj/1jyacA74WxJ1KM6KVcSWymwrdDwb3HDcdpwiNJ5yssot1He0U9vXoQVlg==">(()=>{var b=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("theme");b&&a===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),b&&a==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),a==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=/main.2d475f10e5b9f77c78db0bede08bfbe837a2fac3248bf7fbfede3aaefe3d93e1921d6fb9a8a6f0812476f859cdbc75077c1e84ae61e1f32892e3789e3f76ddea.css integrity="sha512-LUdfEOW593x42wvt4Iv76Dei+sMki/f7/t46rv49k+GSHW+5qKbwgSR2+FnNvHUHfB6ErmHh8yiS43ieP3bd6g==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Latest API improvements Ubiq</title><meta name=description content="Changes to the API and how these can be used for novel purposes."><link rel=canonical href=https://ubiq.online/blog/latest-api-improvements/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Latest API improvements"><meta property="og:description" content="Changes to the API and how these can be used for novel purposes."><meta property="og:url" content="https://ubiq.online/blog/latest-api-improvements/"><meta property="og:site_name" content="Ubiq"><meta property="article:published_time" content="2022-10-19T09:19:42+01:00"><meta property="article:modified_time" content="2023-05-13T14:17:51+02:00"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="640"><meta property="og:image:alt" content="Latest API improvements"><meta property="og:image" content="https://ubiq.online/images/banner.png"><meta property="og:image:width" content="1280"><meta property="og:image:height" content="640"><meta property="og:image:alt" content="Ubiq"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Latest API improvements"><meta name=twitter:description content="Changes to the API and how these can be used for novel purposes."><meta name=twitter:image content><meta name=twitter:image:alt content="Latest API improvements"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://ubiq.online/#/schema/organization/1","name":"Ubiq","url":"https://ubiq.online/","sameAs":["https://github.com/UCL-VR/ubiq"],"logo":{"@type":"ImageObject","@id":"https://ubiq.online/#/schema/image/1","url":"https://ubiq.online/images/logos/ubiq-logo.png","width":512,"height":512,"caption":"Ubiq"},"image":{"@id":"https://ubiq.online/#/schema/image/1"}},{"@type":"WebSite","@id":"https://ubiq.online/#/schema/website/1","url":"https://ubiq.online/","name":"Ubiq","description":"A Unity networking library for research, teaching and development, maintained by the Virtual Environments and Computer Graphics group at UCL. Ubiq is 100% free and open source.","publisher":{"@id":"https://ubiq.online/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://ubiq.online/blog/latest-api-improvements/","url":"https://ubiq.online/blog/latest-api-improvements/","name":"Latest API improvements","description":"Changes to the API and how these can be used for novel purposes.","isPartOf":{"@id":"https://ubiq.online/#/schema/website/1"},"about":{"@id":"https://ubiq.online/#/schema/organization/1"},"datePublished":"2022-10-19T09:19:42CET","dateModified":"2023-05-13T14:17:51CET","breadcrumb":{"@id":"https://ubiq.online/blog/latest-api-improvements/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://ubiq.online/blog/latest-api-improvements/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://ubiq.online/blog/latest-api-improvements/"]}]},{"@type":"BreadcrumbList","@id":"https://ubiq.online/blog/latest-api-improvements/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://ubiq.online/","url":"https://ubiq.online/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://ubiq.online/blog/","url":"https://ubiq.online/blog/","name":"Blog"}},{"@type":"ListItem","position":3,"item":{"@id":"https://ubiq.online/blog/latest-api-improvements/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://ubiq.online/#/schema/article/1","headline":"Latest API improvements","description":"Changes to the API and how these can be used for novel purposes.","isPartOf":{"@id":"https://ubiq.online/blog/latest-api-improvements/"},"mainEntityOfPage":{"@id":"https://ubiq.online/blog/latest-api-improvements/"},"datePublished":"2022-10-19T09:19:42CET","dateModified":"2023-05-13T14:17:51CET","author":{"@id":"https://ubiq.online/#/schema/person/2"},"publisher":{"@id":"https://ubiq.online/#/schema/organization/1"},"image":{"@id":"https://ubiq.online/blog/latest-api-improvements/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://ubiq.online/#/schema/person/2","name":"Nels Numan","sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://ubiq.online/blog/latest-api-improvements/#/schema/image/2","url":null,"contentUrl":null,"width":1826,"height":874,"caption":"Latest API improvements"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://ubiq.online/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ubiq.online/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ubiq.online/favicon-16x16.png><link rel=manifest href=https://ubiq.online/site.webmanifest></head><body class="single section blog"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label=Bootstrap>Ubiq</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-start border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>Ubiq</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://ucl-vr.github.io/ubiq/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/showcase/>Showcase</a></li><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/blog/>Blog</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/publication/>Publications</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/teaching>Teaching</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Contact
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=https://github.com/UCL-VR/ubiq/discussions/categories/q-a>â†— Ask a Question</a></li><li><a class=dropdown-item href=/contributors/>Contributors</a></li><li><a class=dropdown-item href=/media/>Media</a></li></ul></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://discord.gg/cZYzdcxAAB><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 128 128" fill="#000" stroke="currentcolor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-discord"><path d="M45.23 57.2c-6.16.0-11.17 5.6-11.17 12.48s5 12.47 11.17 12.47 11.16-5.59 11.16-12.47S51.38 57.2 45.23 57.2zm0 21c-4 0-7.17-3.8-7.17-8.47s3.21-8.48 7.17-8.48 7.16 3.8 7.16 8.48-3.21 8.42-7.16 8.42z"/><path d="M121.83 59.58a156.78 156.78.0 00-11.52-31 2.1 2.1.0 00-.71-.77 87.08 87.08.0 00-15.23-7.17C84.55 17.07 79.91 17 79.72 17a2 2 0 00-2 1.72l-.6 4.17a133.14 133.14.0 00-26.28.0l-.6-4.17a2 2 0 00-2-1.72c-.19.0-4.83.0-14.65 3.61A87.08 87.08.0 0018.4 27.81a2.1 2.1.0 00-.71.77 156.72 156.72.0 00-11.52 31C1 80.46.0 90.91.0 91.34a2 2 0 00.49 1.5 55.2 55.2.0 0018.2 12.74A76.32 76.32.0 0038.48 111a2 2 0 001.92-1l5.4-9.25A105.08 105.08.0 0064 102.24a105.08 105.08.0 0018.2-1.51L87.6 110a2 2 0 001.72 1h.2a76.32 76.32.0 0019.78-5.38 55.2 55.2.0 0018.2-12.74 2 2 0 00.49-1.5C128 90.91 127.05 80.46 121.83 59.58zm-14.06 42.31a76.76 76.76.0 01-17.39 4.92l-4.08-7c4.68-1.24 14.42-4.46 21.83-11.2a2 2 0 10-2.69-3c-9 8.23-22.46 10.84-22.6 10.87h-.06A96.59 96.59.0 0164 98.24a96.59 96.59.0 01-18.78-1.7h-.06c-.14.0-13.55-2.64-22.6-10.87a2 2 0 10-2.69 3c7.41 6.74 17.15 10 21.83 11.2l-4.08 7a76.08 76.08.0 01-17.39-4.92A52.24 52.24.0 014.08 90.8c.33-2.91 1.68-13.07 6-30.24A156.25 156.25.0 0121 30.92 88.17 88.17.0 0135 24.4a61.35 61.35.0 0111.58-3.19l.35 2.39c-4 1-13.85 3.86-21.65 9.53a2 2 0 102.36 3.23c8.82-6.41 21-9.06 21.86-9.25A118.4 118.4.0 0164 26.27a117.64 117.64.0 0114.51.84c.91.19 13 2.83 21.86 9.25a2 2 0 102.36-3.23c-7.8-5.67-17.61-8.52-21.65-9.53l.35-2.39A61.75 61.75.0 0193 24.4a88.17 88.17.0 0114 6.52 156.25 156.25.0 0111 29.64c4.29 17.17 5.64 27.33 6 30.24a52.24 52.24.0 01-16.23 11.09z"/><path d="M82.77 57.2c-6.15.0-11.16 5.6-11.16 12.48s5 12.47 11.16 12.47 11.17-5.59 11.17-12.47S88.93 57.2 82.77 57.2zm0 21c-4 0-7.16-3.8-7.16-8.47s3.21-8.48 7.16-8.48 7.17 3.8 7.17 8.48S86.73 78.15 82.77 78.15z"/></svg><small class="ms-2 d-md-none">Discord</small></a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/UCL-VR/ubiq/><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><div class="wrap container-xxl" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>Latest API improvements</h1><p><small>Posted October 19, 2022 by <a class="stretched-link position-relative" href=/contributors/sebastian-friston/>Sebastian Friston</a>, <a class="stretched-link position-relative" href=/contributors/ben-congdon/>Ben Congdon</a>&nbsp;&dash;&nbsp;<strong>11&nbsp;min read</strong></small><p></div><p class=lead>See how the messaging API has been made even easier to use in the latest version of Ubiq, and how it supports different communication models for a variety of purposes.</p><h2 id=introduction>Introduction</h2><p>In Ubiq 0.0.3 we have made a number of changes to improve ease of use.</p><p>Our main goal was to simplify object addressing and initialisation - to make creating networked objects as quick and easy as possible, and avoid messages ending up where they aren&rsquo;t expected.</p><p>Another, separate, goal was the ability to automatically synchronise Components, for those who just want to build networked objects as quickly as possible.</p><p>Creating a simple API has a lot of challenges. We must maintain the flexibility required for research, and the transparency required for teaching.
What makes Ubiq distinct is its support for things like local loopback, cross-scene communication and asymmetric addressing - which should be as easy, if not easier, to do in any revisions.</p><p>In this post we explore our updated API. We describe how it works, and how it supports all the use cases we and our users currently rely on, as well as some new ones to try out in the future!</p><h2 id=changes>Changes</h2><p>The biggest change is the removal of <code>ComponentId</code>.</p><p>Now, every <em>Networked Component</em> has its own <code>NetworkId</code>. A Network Id is one 64-bit value, and Network Ids talk to the same Network Ids as before.</p><p>Users no longer have to store Ids or implement interfaces in their classes however; the default behaviour is to get an Id behind the scenes from the scene graph.</p><p>The minimum overhead for a new Component is now:</p><pre><code>class MyObject : MonoBehaviour
{
    NetworkContext context;

    Start()
	{
        context = NetworkScene.Register(this);
    }

    Update()
    {
        context.SendJson&lt;T&gt;();
    }

    ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {
    }
}
</code></pre><p>When you call <code>Register</code> with one argument, Ubiq will generate an Id for the Component. You can get the <code>NetworkId</code> of your Component through the <code>NetworkContext</code> object.</p><h5 id=automatic-addressing>Automatic Addressing</h5><p>Automatic Network Ids are based on the &lsquo;address&rsquo; of a Component, which consists of the nodes leading to it from the common root with its nearest <code>NetworkScene</code>. The root itself and any duplicate names are replaced by locally unique identifiers in each branch. These UTF8 strings are then SHA1 hashed into a <code>NetworkId</code>.</p><p>This approach supports local loopback, duplicate names, cross-project & cross-scene use. As it&rsquo;s deterministic it should also be possible to use address strings on other platforms too. (Though we recommend in this case users synchronise Ids their own way, to avoid depending on implementation details!)</p><p>To see the addresses, the helper Component <code>NetworkIdGizmo</code> can be added to a <code>GameObject</code> with Networked Components on it. In the image below, NetworkIdGizmo has been attached to both instances of a Firework in the Local Loopback Scene, and you can see how the Firework Networked Component is resolved to the same string in both forests, and that the <code>NetworkId</code> in each is the same too.</p><p><figure class=figure><img class="figure-img img-fluid lazyload blur-up" data-sizes=auto src=https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_20x0_resize_box_3.png data-srcset="https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_900x0_resize_box_3.png 900w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_800x0_resize_box_3.png 800w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_700x0_resize_box_3.png 700w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_600x0_resize_box_3.png 600w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_500x0_resize_box_3.png 500w" width=1785 height=1257 alt="Scene View"><noscript><img class="figure-img img-fluid" sizes=100vw srcset="https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_900x0_resize_box_3.png 900w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_800x0_resize_box_3.png 800w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_700x0_resize_box_3.png 700w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_600x0_resize_box_3.png 600w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1_hu79cf30a4606b3de1f0c3ad397e3c5d9c_331185_500x0_resize_box_3.png 500w" src=https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_1.png width=1785 height=1257 alt="Scene View"></noscript></figure></p><p>There is also a local loopback scene in <em>MinimalExamples/Addressing</em> designed for testing this out in various configurations, including branches with duplicate GameObject names, and multiple copies of the same Networked Components added to the same GameObject, both of which are supported.</p><p><figure class=figure><img class="figure-img img-fluid lazyload blur-up" data-sizes=auto src=https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_20x0_resize_box_3.png data-srcset="https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_900x0_resize_box_3.png 900w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_800x0_resize_box_3.png 800w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_700x0_resize_box_3.png 700w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_600x0_resize_box_3.png 600w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_500x0_resize_box_3.png 500w" width=1804 height=1129 alt="Scene View"><noscript><img class="figure-img img-fluid" sizes=100vw srcset="https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_900x0_resize_box_3.png 900w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_800x0_resize_box_3.png 800w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_700x0_resize_box_3.png 700w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_600x0_resize_box_3.png 600w,https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2_hu40fa70b126d14f5e24ea8b87bb7190cb_156144_500x0_resize_box_3.png 500w" src=https://ubiq.online/blog/latest-api-improvements/networkid_gizmo_2.png width=1804 height=1129 alt="Scene View"></noscript></figure></p><p>Of course, users can still assign Network Ids manually, as will be seen below!</p><h5 id=addprocessor>AddProcessor</h5><p>Additionally, <code>NetworkScene</code> has a new method, <code>AddProcessor</code>, that associates a <code>NetworkId</code> directly with a <code>ProcessMessage</code> function. This allows having multiple Network Ids for one Component, and for classes other than <code>MonoBehaviour</code> to recieve messages.</p><h5 id=namespaces>Namespaces</h5><p>To replace Component Ids, Network Ids have been given a new <em>namespaces</em> feature - this allows users to generate a new, derived <code>NetworkId</code> based on an existing one deterministically.</p><h2 id=use-cases>Use Cases</h2><p>The following examples show how various use cases are supported&mldr;</p><h4 id=1-standard-networked-component>1. Standard Networked Component</h4><p>In the most common example, users create Networked Components in their scene that they want to be synchronised. They write their own <code>ProcessMessage</code> method, and build and send their own messages.</p><p>In this case users create a regular Unity Component and call <code>Register</code>. They can send via the <em>context</em> object, and receive via <code>ProcessMessage</code>, as before.</p><pre><code>class MyObject : MonoBehaviour
{
    NetworkContext context;

    Start()
	{
        context = NetworkScene.Register(this); // Messages are sent to the counterpart of this object in other NetworkScenes based on their name and position in the scene graph.
    }

    Update()
    {
        context.SendJson(&quot;My Message&quot;);
    }

    ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {
    }
}
</code></pre><p>No subclassing or interfaces are required.</p><p>The <code>ProcessMessage</code> method is found using Reflection (and a warning printed if it can&rsquo;t be found). <a href="https://learn.microsoft.com/en-us/dotnet/api/system.delegate.createdelegate?view=net-6.0">CreateDelegate</a> is used to bind the reflected method, which means it should be as <a href=https://blogs.msmvps.com/jonskeet/2008/08/09/making-reflection-fly-and-exploring-delegates/>fast as a native virtual method</a>.</p><p>The <em>MinimalExamples/Addressing</em> sample shows sets of cubes synchronised this way in local loopback.</p><h4 id=2-spawned-objects-with-one-networked-component>2. Spawned Objects with One Networked Component</h4><p>The second use case is spawned objects with one Networked Component. In this case users implement <code>INetworkSpawnable</code>, which defines a property, <code>NetworkId</code>, as before. Users should implement it with the default <code>get</code> and <code>set</code> accessors, however (no more odd initialisers!).</p><p>When the <code>NetworkSpawner</code> creates a new instance, it assigns the Network Id explicitly.</p><p>The Component is registered using <code>Register(this)</code> as before. Users don&rsquo;t need to pass the <code>NetworkId</code> to the Network Scene: the <code>Register</code> function detects <code>INetworkSpawnable</code> and does this itself.</p><p>(In fact, behind the scenes Network Scene looks for the <code>NetworkId</code> property directly, not the interface, to avoid creating dependencies between services and the <code>NetworkScene</code> class, so users dont actually have to declare the interface to define Ids this way).</p><p>So, a Spawnable Object would look like this:</p><pre><code>class MySpawnable: MonoBehaviour, INetworkSpawnable
{
    NetworkId NetworkId {get;set;} // This is just to satisfy INetworkSpawnable. Users don't have to use it to register their objects, though if they do it will work the same way.
    NetworkContext context;

    Start()
    {
        context = NetworkScene.Register(this);
    } 

    Update()
    {
        context.SendJson&lt;T&gt;();
    }

    ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {
    }
}
</code></pre><p>You can see this on the <em>Firework</em> example in <em>Start Here</em>.</p><h4 id=3-unicast-service-addressing>3. Unicast Service Addressing</h4><p>The third use case is unicast service addressing. This is where Components on Peers need to talk to each other, and <em>only</em> each other.</p><p>An example is the <code>VoipPeerConnectionManager</code>, which does this to create new voice chat sessions between only two Peers.</p><p>For this use case we introduce <em>derived</em> or <em>namespaced</em> Network Ids. These Ids are a hash of two other Network Ids.
So, a service such as a Peer&rsquo;s <code>VoipPeerConnectionManager</code> would have a <code>NetworkId</code> created by combining its <em>Network Scene</em> Id with a <em>service</em> Id.</p><p>For <code>VoipPeerConnectionManager</code>, the service Id is <code>c994-0768-d7b7-171c</code>.</p><p>Components on other Peers can work out how to address a specific Peer&rsquo;s Component, based on the specific Peer&rsquo;s <code>NetworkScene</code> Id and the shared secret (service Id).</p><p>This example is a little more complex, and doesn&rsquo;t use the Context object:</p><pre><code>class VoipPeerConnectionManager: MonoBehaviour
{â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    NetworkId serviceId = new NetworkId(&quot;c994-0768-d7b7-171c&quot;); // The unique service Id that specifies we want to address the VoipPeerConnectionManager class
    NetworkScene scene;


    Start(){â€‹â€‹â€‹â€‹â€‹â€‹â€‹
        var scene = NetworkScene.Find(this);
        NetworkScene.Register(this, NetworkId.Create(scene.Id, serviceId)); // Here we create a new Id for this VoipPeerConnectionManager *instance*
    }â€‹â€‹â€‹â€‹â€‹â€‹â€‹


    Update()
    {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
        foreach(var otherPeer in otherPeers)
        {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
            scene.SendJson(NetworkId.Create(otherPeer.networkId, serviceId), myMessage); // Address the unique instance of VoipPeerConnectionManager on a specific Peer, by working out what it will have set its unique Id to...
        }â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    }â€‹â€‹â€‹â€‹â€‹â€‹â€‹


    ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    }â€‹â€‹â€‹â€‹â€‹â€‹â€‹
}â€‹â€‹â€‹â€‹â€‹â€‹â€‹
</code></pre><p>When creating derived Ids, the second parameter can be a <code>NetworkId</code>, like in the example above, but it can also be an integer, or a string. So a service identifier could just be a name like &ldquo;VoipPeerConnectionManager&rdquo;, instead of a UID.</p><h4 id=4-multicast-service-addressing>4. Multicast Service Addressing</h4><p>The fourth use case is multicast service addressing. This is where services need to talk to all other services (typically including some outside Unity). An example is the <code>ThroughputBenchmark</code> Component.</p><p>This is very similar to how regular Networked Components work - the only difference is the <code>NetworkId</code> is fixed, and set at design time, instead of being generated from the scene graph.</p><p>The implementation is similarly simple too: the Component is registered as before, but the Id is explicitly assigned when calling <code>Register</code>.</p><pre><code>class MulticastService: MonoBehaviour
{
    NetworkContext context;

    Start()
	{
        context = NetworkScene.Register(this, new NetworkId(&quot;162a-5711-6a98-4218&quot;)); // The shared service Id. All instances will talk to all other instances.
    }

    Update()
    {
        context.SendJson(); // Address all other instances of this service
    } 

    ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {
    }
}
</code></pre><h4 id=5-spawned-objects-with-multiple-networked-components>5. Spawned Objects with Multiple Networked Components</h4><p>The fifth use case is spawned objects with multiple Components. An example of this is the <code>ThreePointTrackedAvatar</code>, or any other Component attached to an Avatar.</p><p><code>NetworkSpawner</code> can handle Prefabs with multiple Network Components, so users can simply implement <code>INetworkSpawnable</code> on each Component.</p><p>Or if they prefer, users can use the namespace/derived Network Ids to create Ids based on the one assigned by the Network Spawner. (This is how the Component Ids used to work.)</p><p>Option 1:</p><pre><code>ThreePointTrackedAvatar: MonoBehaviour, INetworkSpawnable
{
    // The NetworkSpawner can handle Prefabs with multiple networked components, and will synchronise each of them correctly.
    Start()
    {
        context = NetworkScene.Register(this);
    }
}
</code></pre><p>Option 2:</p><pre><code>ThreePointTrackedAvatar: MonoBehaviour
{
    //'avatar' is a member of ThreePointTrackedAvatar and is itself INetworkSpawnable. This allows us to get an Id derived from the one the spawner sets on Avatar, based on the string &quot;ThreePointTrackedAvatar&quot;.
    Start()
    {
        context = NetworkScene.Register(this, NetworkId.Create(avatar.NetworkId, &quot;ThreePointTrackedAvatar&quot;);
    }
}
</code></pre><h4 id=6-multimode-addressing>6. Multimode Addressing</h4><p>The sixth use case is multimode addressing. This is used where the same Component needs to handle broadcast and unicast messages in one. This is used, for example, by <code>LogCollector</code>.</p><p>In this use case the <code>AddProcessor</code> method is used to register callbacks to multiple Ids, each with a differnet usage!</p><p>The Ids themselves (or more accurately how they are used) determine whether a message is delivered via multicast or unicast.</p><pre><code>public class LogCollector : MonoBehaviour
{â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    NetworkId broadcast;
    NetworkId unicast;
    NetworkId destination; // can change as a result of a broadcast
    NetworkScene scene;
    
    Start()
    {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
        scene = NetworkScene.Find(this);
        broadcast = new NetworkId(&quot;162a-5711-6a98-4218&quot;); // A shared address
        unicast = NetworkId.Create(broadcast, scene.Id); // A unique address
        scene.AddProcessor(broadcast, ProcessMessage);
        scene.AddProcessor(unicast, ProcessMessage);
    }â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    
    public void RequestDestinationChange()
    {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
        scene.SendJson(broadcast, new Message(unicast)); // Broadcast my Unicast Id to all other Peers
    }â€‹â€‹â€‹â€‹â€‹â€‹â€‹


    public void ProcessMessage(ReferenceCountedSceneGraphMessage message)
    {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
        if(IsBroadcast(message))
        {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
            destination = message.id;
        }â€‹â€‹â€‹â€‹â€‹â€‹â€‹
        else
        {â€‹â€‹â€‹â€‹â€‹â€‹â€‹
            HandleUnicastMessage(message);
        }â€‹â€‹â€‹â€‹â€‹â€‹â€‹
    }â€‹â€‹â€‹â€‹â€‹â€‹â€‹
}â€‹â€‹â€‹â€‹â€‹â€‹â€‹
</code></pre><p>In the example above, the Log Collector class uses a broadcast message to change which unicast address all other Log Collectors in the Peer Group should send their unicast messages to.</p><h4 id=7-networked-behaviours>7. Networked Behaviours</h4><p>The seventh use case is for those who already know the basics of message passing, and just want to create networked behaviours as quickly as possible.</p><p>In this use case Ubiq automatically synchronises the members of a Component without the user needing to send or receive messages themselves.</p><p>A new system has been added for this: <em>NetworkedBehaviours</em>. All users have to do is register their component like so&mldr;</p><pre><code>public class MyNetworkedBehaviour : MonoBehaviour
{    
    public float property1;
    public string property2;
    
    [SerializeField]
    private float property3;
    
    private string property4; // Not transmitted

    Awake()
    {
        NetworkedBehaviours.Register(this); // Note we are calling NetworkedBehaviours.Register(), not NetworkScene.Register()!
    }
}
</code></pre><p>The class uses the Unity JSON utility underneath, and so follows the Unity Serialisation rules&mldr;</p><ul><li>public fields, but not properties,</li><li>private fields with [SerializeField],</li><li>lists, but not dictionaries</li><li><a href=https://docs.unity3d.com/2020.1/Documentation/Manual/JSONSerialization.html>and more</a></li></ul><p>In the future we could add functionality to swap the serialisation library, or add <a href=https://docs.unity3d.com/ScriptReference/ISerializationCallbackReceiver.html>interfaces</a> to control the behaviour.</p><p>Users can also add the <code>NetworkTransform</code> attribute to their <code>MonoBehaviour</code>, and Networked Behaviours will synchronise the local transform as well:</p><pre><code>[NetworkTransform]
public class MyNetworkedBehaviour : MonoBehaviour
{
    ...
}
</code></pre><p>The way this works underneath is that <code>NetworkedBehaviours</code> is a static class that creates methods to serialise and deserialise the <code>MonoBehaviour</code> outside of the <code>MonoBehaviour</code> itself. This is why Networked Behaviours does not need users to subclass their Component. These methods are then registered with the Component&rsquo;s closest <code>NetworkScene</code> on its behalf.</p><p>This is demonstrated in the <em>MinimalExamples/NetworkedBehaviour</em> scene.</p><p>There is also another example in the <em>Addressing</em> scene, demonstrating that custom Networked Components and Networked Behaviours Components can be intermixed on one GameObject, and both will still work.</p><h2 id=conclusion>Conclusion</h2><p>Our latest update has retired probably most confusing aspect of object addressing: the ObjectId/ComponentId separation.</p><p>All Components now have their own, complete, NetworkId. This should hopefully bring Ubiq&rsquo;s behaviour closer to the ideal mental model of Components talking to other instances of themselves.</p><p>Ubiq still routes messages the same way as before: with Ids multicasting to matching Ids. And it is still possible to register an explicit Id, and send to another, explicit, Id. We hope now with only one variable to worry about - and new ways of creating it - users will feel more confident to mix and match, and try out new atypical communication patterns, like those shown above!</p><p>As part of these revisions we have maximised the use of Reflection to remove interfaces and other requirements on setting up Components, that without an obvious reason left intialisation tricky and potentially error prone.</p><p>We hope the cleaner API makes it easier for users to create new Networked Components so they can focus less on Ubiq, and more on coding new & interesting networked behaviours.</p><div class="alert alert-info d-flex" role=alert><div class="flex-shrink-1 alert-icon"></div><div class=w-100>Do you have a particular use case or application in mind? We always appreciate hearing from our users! So please feel free to share any thoughts on these updates on our <a href=https://github.com/UCL-VR/ubiq/discussions>GitHub Discussion</a> page, or reach out to <a href=mailto:sebastian.friston@ucl.ac.uk>Sebastian</a> or <a href=mailto:ben.congdon.11@ucl.ac.uk>Ben</a> directly.</div></div></article></div></div></div></div><section class="section section-sm mt-n5 mb-3"><div class=container><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"></div></div></div></section><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script data-goatcounter=https://ubiq.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script src=/js/bootstrap.min.fdbe9b9ba88a036135318f3c721784d684ac9e3280fe282cc80d7d49f7f9c82780cd54228c1608685a230c09984300d7946fc471734d566fcebc148b65bd16db.js integrity="sha512-/b6bm6iKA2E1MY88cheE1oSsnjKA/igsyA19Sff5yCeAzVQijBYIaFojDAmYQwDXlG/EcXNNVm/OvBSLZb0W2w==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.2a3ca603c4e5468838fb437bc036b9ddc036b6668b5dd45804f048229ea684f98f5928dd485b41db90e55aaa28b36600341f082d2726650a0a394250b6bf3ac1.js integrity="sha512-KjymA8TlRog4+0N7wDa53cA2tmaLXdRYBPBIIp6mhPmPWSjdSFtB25DlWqoos2YANB8ILScmZQoKOUJQtr86wQ==" crossorigin=anonymous defer></script>
<script src=/main.min.7692813ef22de5d343339990192d5774c0742a9334f8f57bb78245f5ab0e02861e3e47e7308e649ca0173ef9e307477de2769299fdb90a9e4a5e327df94553b7.js integrity="sha512-dpKBPvIt5dNDM5mQGS1XdMB0KpM0+PV7t4JF9asOAoYePkfnMI5knKAXPvnjB0d94naSmf25Cp5KXjJ9+UVTtw==" crossorigin=anonymous defer></script></body></html>